<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textos - Pachi Parra</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap">
    <link rel="stylesheet" href="style.css">
    <!-- Adiciona a biblioteca marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Estilo básico para o botão voltar */
        #back-button {
            display: none; /* Escondido por padrão */
            margin-bottom: 20px;
            cursor: pointer;
            color: var(--color3);
            text-decoration: underline;
        }
        #post-content article {
             margin: 40px 0;
            padding: 20px;
            border-left: 3px solid var(--color3);
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 0 10px 10px 0;
        }
         #post-content article h1, #post-content article h2, #post-content article h3 {
             color: var(--color1);
             margin-top: 0;
             font-size: 1.6rem; /* Reutiliza estilo .texto h2 */
             font-family: 'Lucida Calligraphy', 'Brush Script MT', cursive; /* Reutiliza estilo h2 */
         }
        /* Estilo para os botões de filtro */
        #filter-buttons button {
            margin-right: 10px;
            padding: 5px 10px;
            cursor: pointer;
            background-color: var(--color2);
            color: white;
            border: none;
            border-radius: 5px;
        }
        #filter-buttons button.active {
            background-color: var(--color1);
        }
    </style>
</head>
<body>
    <header>
        <h1>Meus Textos</h1>
        <nav>
            <ul>
                <li><a href="index.html">Página Inicial</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="conteudo">
            <!-- Botão para voltar para a lista -->
            <div id="back-button">&larr; Voltar para a lista</div>

            <!-- Botões de Filtro -->
            <div id="filter-buttons" style="margin-bottom: 20px;">
                <span>Filtrar por:</span>
                <button onclick="filterPosts('todos')" class="active">Todos</button>
                <button onclick="filterPosts('conto')">Contos</button>
                <button onclick="filterPosts('poema')">Poemas</button>
                 <!-- Adicione mais botões para outras tags se necessário -->
            </div>

            <!-- Área onde a lista de posts será carregada -->
            <div id="post-list">
                <p>Carregando textos...</p>
            </div>

            <!-- Área onde o conteúdo do post selecionado será carregado -->
            <div id="post-content"></div>

        </section>

        <!-- Navegação movida para o header, seção removida -->

    </main>

    <footer>
        <p>&copy; 2024 Pachi Parra. Todos os direitos reservados.</p>
    </footer>

    <script>
        const postListDiv = document.getElementById('post-list');
        const postContentDiv = document.getElementById('post-content');
        const backButton = document.getElementById('back-button');
        const filterButtonsContainer = document.getElementById('filter-buttons'); // Pega o container dos botões

        let currentFilter = 'todos'; // Filtro inicial

        // --- Lista de Posts ---
        // Adicione seus posts aqui. O 'file' é o caminho para o arquivo .md
        // Use 'tags' como um array de strings
        const posts = [
            { title: "Exemplo de Conto", file: "posts/exemplo-conto.md", tags: ["conto"] },
            // { title: "Exemplo de Poema", file: "posts/exemplo-poema.md", tags: ["poema"] },
            // Adicione mais posts aqui
        ];

        // Função para mostrar a lista de posts e esconder o conteúdo individual
        function showPostList() {
            postContentDiv.innerHTML = ''; // Limpa conteúdo do post
            postContentDiv.style.display = 'none';
            backButton.style.display = 'none';
            postListDiv.style.display = 'block';
        }

        // Função para carregar e exibir um post específico
        async function loadPost(mdFile) {
            try {
                const response = await fetch(mdFile);
                if (!response.ok) {
                    throw new Error(`Erro ao carregar ${mdFile}: ${response.statusText}`);
                }
                const markdownWithFrontMatter = await response.text();

                // Simples remoção do front matter (assume que termina com ---)
                const contentStartIndex = markdownWithFrontMatter.indexOf('\n---', 4); // Procura o segundo '---'
                const markdown = contentStartIndex > 0 ? markdownWithFrontMatter.substring(contentStartIndex + 4) : markdownWithFrontMatter;

                const htmlContent = marked.parse(markdown); // Converte Markdown para HTML

                // Encontra o post correspondente para obter o título
                const postData = posts.find(p => p.file === mdFile);
                const title = postData ? postData.title : 'Título não encontrado';
                // const type = postData ? postData.type : ''; // Não precisamos mais do type aqui

                // Cria a estrutura do artigo similar ao .texto original
                postContentDiv.innerHTML = `
                    <article class="texto">
                        <h2>${title}</h2>
                        ${htmlContent}
                    </article>
                `;
                postListDiv.style.display = 'none'; // Esconde a lista
                postContentDiv.style.display = 'block'; // Mostra o conteúdo
                backButton.style.display = 'block'; // Mostra o botão voltar
            } catch (error) {
                console.error('Erro:', error);
                postContentDiv.innerHTML = `<p>Não foi possível carregar o texto. Tente novamente mais tarde.</p>`;
                postListDiv.style.display = 'none';
                postContentDiv.style.display = 'block';
                backButton.style.display = 'block';
            }
        }

        // Função para gerar a lista de links dos posts, filtrada pela tag
        function renderPostList() {
            const filteredPosts = posts.filter(post =>
                currentFilter === 'todos' || (post.tags && post.tags.includes(currentFilter))
            );

            if (filteredPosts.length === 0) {
                postListDiv.innerHTML = `<p>Nenhum texto encontrado para a tag "${currentFilter}".</p>`;
                return;
            }

            let listHtml = '<ul>';
            filteredPosts.forEach(post => {
                // Adiciona um link que chama loadPost quando clicado
                // Removemos a exibição da tag/tipo no link
                listHtml += `<li><a href="#" onclick="loadPost('${post.file}'); return false;">${post.title}</a></li>`;
            });
            listHtml += '</ul>';
            postListDiv.innerHTML = listHtml;

            // Atualiza a classe 'active' nos botões de filtro
            const buttons = filterButtonsContainer.querySelectorAll('button');
            buttons.forEach(button => {
                if (button.textContent.toLowerCase().includes(currentFilter) || (currentFilter === 'todos' && button.textContent === 'Todos')) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }

        // Função chamada pelos botões de filtro
        function filterPosts(tag) {
            currentFilter = tag;
            renderPostList(); // Re-renderiza a lista com o novo filtro
            showPostList(); // Garante que a lista seja exibida (caso um post estivesse aberto)
        }

        // Event listener para o botão voltar
        backButton.addEventListener('click', showPostList);

        // Inicialização: Renderiza a lista de posts quando a página carrega
        renderPostList(); // Renderiza com o filtro inicial 'todos'
        showPostList(); // Garante que a lista seja exibida inicialmente

    </script>

</body>
</html>