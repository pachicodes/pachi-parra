<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textos - Pachi Parra</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap">
    <link rel="stylesheet" href="style.css">
    <!-- Adiciona a biblioteca marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Tag <style> removida, estilos movidos para style.css -->
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <h1><a href="index.html" style="text-decoration: none; color: inherit;">Textos</a></h1> <!-- Link para home no logo -->
            </div>
            <nav>
                <ul>
                    <li><a href="sobre.html">Sobre Mim</a></li> <!-- Link atualizado -->
                   <li><a href="textos.html">Textos</a></li>
                    <li><a href="mailto:pahparra@gmail.com">Email</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section id="conteudo" class="container"> <!-- Adiciona classe container para limitar largura -->
            <!-- Botão para voltar para a lista -->
            <div id="back-button">&larr; Voltar para a lista</div>

            <!-- Botões de Filtro -->
            <div id="filter-buttons"> <!-- Remove estilo inline -->
                <span>Filtrar por:</span>
                <button onclick="filterPosts('todos')" class="active">Todos</button>
                <button onclick="filterPosts('conto')">Contos</button>
                <button onclick="filterPosts('poema')">Poemas</button>
                 <!-- Adicione mais botões para outras tags se necessário -->
            </div>

            <!-- Área onde a lista de posts será carregada -->
            <div id="post-list">
                <p>Carregando textos...</p>
            </div>

            <!-- Área onde o conteúdo do post selecionado será carregado -->
            <div id="post-content"></div>

        </section>

        <!-- Navegação movida para o header, seção removida -->

    </main>

    <footer>
        <p>&copy; 2025 Pachi Parra. Todos os direitos reservados.</p> <!-- Atualiza ano -->
    </footer>

    <script>
        const postListDiv = document.getElementById('post-list');
        const postContentDiv = document.getElementById('post-content');
        const backButton = document.getElementById('back-button');
        const filterButtonsContainer = document.getElementById('filter-buttons'); // Pega o container dos botões

        let currentFilter = 'todos'; // Filtro inicial

        // --- Lista de Posts ---
        // Adicione seus posts aqui. O 'file' é o caminho para o arquivo .md
        // Use 'tags' como um array de strings
        const posts = [
            { title: "Exemplo de Conto", file: "posts/exemplo-conto.md", tags: ["conto"] },
            { title: "Fofoca pela Metade", file: "posts/fofoca-pela-metade.md", tags: ["conto"] }, // Adiciona novo post
            // { title: "Exemplo de Poema", file: "posts/exemplo-poema.md", tags: ["poema"] },
            // Adicione mais posts aqui
        ];

        // Função para mostrar a lista de posts e esconder o conteúdo individual
        function showPostList() {
            postContentDiv.innerHTML = ''; // Limpa conteúdo do post
            postContentDiv.style.display = 'none';
            backButton.style.display = 'none';
            postListDiv.style.display = 'block';
        }

        // Função para carregar e exibir um post específico
        async function loadPost(mdFile) {
            try {
                const response = await fetch(mdFile);
                if (!response.ok) {
                    throw new Error(`Erro ao carregar ${mdFile}: ${response.statusText}`);
                }
                const markdownWithFrontMatter = await response.text();

                // Simples remoção do front matter (assume que termina com ---)
                const contentStartIndex = markdownWithFrontMatter.indexOf('\n---', 4); // Procura o segundo '---'
                const markdown = contentStartIndex > 0 ? markdownWithFrontMatter.substring(contentStartIndex + 4) : markdownWithFrontMatter;

                const htmlContent = marked.parse(markdown); // Converte Markdown para HTML

                // Encontra o post correspondente para obter o título
                const postData = posts.find(p => p.file === mdFile);
                const title = postData ? postData.title : 'Título não encontrado';
                // const type = postData ? postData.type : ''; // Não precisamos mais do type aqui

                // Cria a estrutura do artigo similar ao .texto original
                postContentDiv.innerHTML = `
                    <article> <!-- Remove a classe texto daqui -->
                        <h2>${title}</h2>
                        ${htmlContent}
                    </article>
                `;
                postListDiv.style.display = 'none'; // Esconde a lista
                postContentDiv.style.display = 'block'; // Mostra o conteúdo
                backButton.style.display = 'block'; // Mostra o botão voltar
            } catch (error) {
                console.error('Erro:', error);
                postContentDiv.innerHTML = `<p>Não foi possível carregar o texto. Tente novamente mais tarde.</p>`;
                postListDiv.style.display = 'none';
                postContentDiv.style.display = 'block';
                backButton.style.display = 'block';
            }
        }

        // Função para gerar a lista de links dos posts, filtrada pela tag
        function renderPostList() {
            const filteredPosts = posts.filter(post =>
                currentFilter === 'todos' || (post.tags && post.tags.includes(currentFilter))
            );

            if (filteredPosts.length === 0) {
                postListDiv.innerHTML = `<p>Nenhum texto encontrado para a tag "${currentFilter}".</p>`;
                return;
            }

            let listHtml = '<ul>';
            filteredPosts.forEach(post => {
                // Adiciona um link que chama loadPost quando clicado
                // Removemos a exibição da tag/tipo no link
                listHtml += `<li><a href="#" onclick="loadPost('${post.file}'); return false;">${post.title}</a></li>`;
            });
            listHtml += '</ul>';
            postListDiv.innerHTML = listHtml;

            // Atualiza a classe 'active' nos botões de filtro
            const buttons = filterButtonsContainer.querySelectorAll('button');
            buttons.forEach(button => {
                // Ajusta a lógica para comparar o texto do botão com o filtro
                const buttonTag = button.textContent.toLowerCase();
                if (buttonTag === currentFilter || (currentFilter === 'todos' && buttonTag === 'todos')) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }

        // Função chamada pelos botões de filtro
        function filterPosts(tag) {
            currentFilter = tag;
            renderPostList(); // Re-renderiza a lista com o novo filtro
            showPostList(); // Garante que a lista seja exibida (caso um post estivesse aberto)
        }

        // Event listener para o botão voltar
        backButton.addEventListener('click', showPostList);

        // Inicialização: Renderiza a lista de posts quando a página carrega
        renderPostList(); // Renderiza com o filtro inicial 'todos'
        showPostList(); // Garante que a lista seja exibida inicialmente

    </script>

</body>
</html>